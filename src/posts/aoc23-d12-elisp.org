#+title: Advent of Code '23 - day 12
#+date: <2023-12-12 Tue>

#+begin_preview
#+end_preview

* Input
** Example
#+name: example
#+begin_example
???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1
#+end_example

** Input                                                           :noexport:
#+name: input
#+begin_example
??#??#????## 2,7
..?##????????.?#?.? 10,2
#??.???..? 1,1,1
#??.#??.??#?#????#?# 2,1,6,3
?.#??.????..?.??? 1,2
#???##?.???#? 2,3,5
?##??#????.??. 2,3,2
??.#??#?????##? 2,1,3,4
?#????#?#.. 2,1,3
?#???#???##?#??? 2,11
#?##??.#??#?? 6,2,1
#.?#????#?#.?? 1,2,5,2
????#?#?#???? 1,6,1,1
.?????.??? 2,1
????????.?#.??? 5,1,1,1
????..???????.??? 1,1
?#???#??#??.????.# 11,1,1,1
???.#?.???#? 2,2,2
???.???.????##? 1,5
??#?#???.#??????#??? 1,5,3,3
???.???.????. 1,2,1,1
????#?...????. 4,1
?.????#??#? 1,7
.?#?.?.##?.?????? 1,3,2,2
????.?????##?.# 3,8,1
????#..????? 1,1,3
.?#???.#????. 1,2,1,2
????.??###.#??.??? 1,1,4,3,1
?????????? 1,1,1
?#.??#...???? 2,1,1
?#????#?????? 7,3
?????.#####??? 1,6
?..?##.#?????? 1,2,4
#??#?#???????????#? 1,4,1,4,1,1
??#??###.???#??. 3,3,3
??????.?#??.?? 3,2
?#???#??#??..?# 6,1,2
#.??.??##?????#?? 1,1,10
.?#???#?.? 2,4
???..????## 2,1,2
??????????????? 1,3,1
??##???????### 1,6,4
?#??????.??? 2,1
??#??????#???? 5,2,2
?#.??#???#?? 2,2,1,1
??#?????#???????. 2,1,1,4
?#?##??#?.. 4,3
##?????#??.??? 9,1,1
??.?...????#???#? 2,9
?????????.? 3,1
.???.??#?.????? 2,4,1
#?##.?#?#????? 4,1,6
????#??#?#??? 1,8
.??.?.###?????? 1,7
??##????#. 4,1,2
???#?.???. 2,1
.?##?##?#?.?#????# 7,3,3
#????..####??.#? 2,1,4,1,1
#..#?#?????#??? 1,9
#.??????.?#??#..???# 1,6,1,1,1,1
???????##?#???#.??? 1,1,5,2,2
?#????.???#? 5,3
#.?#?##??????#?#?? 1,14
.????..?.#???#. 1,1,1,2,1
?#????#???.#????? 8,1,2
????#?.??#??????. 1,3,7
??.??.?.???? 1,1,1,1
??#????..??? 2,1,1,2
?.??#??#??#?.?.???# 10,2
.?#.??#??.? 1,5
?.##????????##?? 4,1,3
.?.??##?#??? 1,6
?????#.??? 1,1,1
.#?#???#???? 4,3,1
????#??.??????? 1,3,1,1,1
???#?.??#?##?# 3,7
?#?#?#???????? 8,1
??.?#????? 1,2
?#???#????.??????? 1,1,3,1,1,1
##???.???.? 3,3
####???????.???? 4,3,1
??#?##??????? 6,3
?..??????? 3,2
.?#??###????#? 8,3
##?###????? 8,1
?.?#?????###??.??#?? 10,1
??????#?????? 3,1,1,1
.#???#?#?.?????? 1,5,1,2,1
???.#???#.??#?#?. 1,2,2,5
..???#????### 1,2,4
????#???#????. 1,7,1
??????#????#.? 3,7,1
???#???????#?...? 4,5,1
#????????##?# 1,3,4
?.#???.???#??. 3,4
.???????.??????.? 4,2,1,3
.?.??.???? 2,2
.???.??????###?#. 3,10
????..?????## 2,1,2,4
#?.???#??.??? 1,4,1
?????..???? 1,4
??????#.????????? 3,1,8
????#??????? 5,1,1,1
????#?#??#????? 1,4,1,2,1
?#?.???#???.? 2,6,1
?.???#??.?#. 1,1,1,1
??.#.#.??????#???? 1,1,1,10
.##?.?????.. 2,2,1
???#?#??#??#??#? 5,1,1,1
?#.?.????????????#? 1,1,10
??#?????.. 3,1
?#.?#?#?????.?????? 1,2,3,1,4,1
?#???..#?.??#?#. 2,1,2,1,1
.????#????.?#?????# 7,1,3
..###??#???#???.??? 10,1,1
??????##?.?#?#.#??# 4,3,2,1,2,1
?.???####.?#?? 4,2
?#.???#???#??##?#?? 1,15
?.?##?#?#? 5,2
?#???#?#??????##??? 9,3
.??????????.??. 6,3,1
???????.#? 1,2,1
????#?#??#?#.. 5,6
?????.?.?#????? 2,1,5
????..??#?#?#??.???? 3,8
#???.?.??????. 1,2,1,2
?????????.???????.?. 1,2,3,4,1
????????##???? 1,7
?.??#.?#??#? 1,1,5
#??????#?##??? 3,9
???#??.?.#?#??### 4,8
?.##??##?#??? 2,7
.?.#?#?????.#?#??.? 1,8,1,1,1,1
?.???#.?????? 2,2
.#.??##???.#??.??. 1,5,3,1
??#???##?? 1,1,4
??????#??##?#. 2,8,1
????#?????.???.?.? 6,1,3
.?.#.?##.??.????#? 1,1,2,2,2,2
.??#?.???? 4,1,1
?.?#?##??##?#??.?? 2,8,1,1
#???##???.??. 1,2,1,1
?#???##??.??#??? 3,3,5
.???#??#??? 1,5,1
?#.?????#???. 2,7
?.???#????????.?. 1,1,1,4,1
??#??#.??#??? 4,1,2
???#.????#???##???? 2,12
..??????.??#??#?? 2,6
??#?.?#?#???..??#?? 3,4,1,1,2
?#????.#?????#?. 2,3,3,3
?????#????.? 2,3,1
.?.?????.?.##.? 5,2
.???.???.???#?? 1,2,3
.????.?#?#???.??. 1,7,2
???#???#??????.. 1,9,1
.#???#?.?? 1,2
##?#??#?##??????#??# 2,7,8
?.?????#????##??.?? 1,8,2,1
??????#.##??##?##?## 3,1,9,2
???#?#?#???#? 1,7,1
???#????.?????? 6,1,1
?.##?#.?#?.?. 1,2,1,2
.????.?..?????? 1,2,1,3,1
?.??????.. 1,1
.?????.?#??. 1,4
???.??????... 2,1
?#?#?#?#.?..#..??? 6,1,1,1,1,1
.??..?#???? 2,1,1
??#?????????#?..??? 10,2,1
?.???.?.?.?.#? 1,2,1,2
#?.?#?.?#???.??????# 2,2,2,1,2,2
????..??####???#?? 4,1,10
.????..??#?? 1,3
.#??#?#?.?.##. 6,2
??#?#..?.??#?#??# 2,1,1,5,1
??##??#??###??..??? 3,7,1,1
????.#.???..??. 1,1,1,1,2
#?.??..??. 1,1,1
.#??????#?.????? 1,5,3,1
?.???#?..??#??? 4,4
?????##?#..#???#?? 7,1,1,1,1,1
?????????? 5,2
????.????.?#?.. 1,1,3
????????????#????#? 4,2,5,4
???#???.??##? 1,1,1,5
?##????????#????##?. 2,7,3
???..??#?? 2,3
#.?#?.???..?? 1,3,3,1
.????????? 2,1,1
???????????##? 6,1,2
?..#????#?? 2,3
????.??..#? 3,1,2
.#.?????#.?#?? 1,2,1,3
????????.?# 7,1
?????#?#??##??#???? 15,2
?#.??.?????#?? 1,1,7
??????#????#?#????? 8,1,7
#..????#???. 1,4,1
##??#.??????. 2,1,2,2
.????.#?#####?. 1,1,7
#????#???..?????? 9,4
???#??.#?.# 3,1,1
.?#?#.?..???? 4,2
??...??.?#?##??? 1,2,8
?.??#?????..???.?.? 5,1,1
?.?##??.?#?##????# 5,5,3
??#?????##??????? 9,1
???#????#? 1,2,2
?.?????????#?#?.?#? 1,3,7,2
???.?#??##?#?? 1,1,5,2
?????.#.?? 3,1,1
?#???#???..??.##??? 2,6,1,5
#??#????????? 2,1,3,1
.#??.?.??.?#. 2,2,1
.???#???????#??##??? 12,2,2
##?#?#???###???????? 13,1,1,1
.?#.??##?????.? 1,3,2,1
#????.???#????. 1,1,3,2
##????????? 2,1,2
?#?..?#????.??? 3,6
.?..??.??#??#?#? 1,1,7
?????????.???.? 1,1,1,2,1
??.????#.???? 1,1,1,2
###?##.??? 6,2
.?#####???????.#??? 5,6,4
.???.??????????? 1,2,1,1,2
?????#?#?#.??#??? 6,1,1,2,1
??.??#???.. 2,1,1
#..?.?.##??. 1,1,3
?##???.?.? 4,1,1
????????##??????.??# 1,10,1,1,1
???#.???.?????? 1,2,1,2,2
????????????.????#? 1,3,3
.?.?????..?#?? 1,1,1,3
?..???##????##? 1,9
.??????#??? 1,2,5
.#?????.?..#???## 1,3,1,1,3
#????.???.? 5,1,1
.?#.?????#??##??? 1,12
???.?#???.?#?? 2,4,4
?.?.??????.?????#?? 1,5,8
???##?#?#?.#. 4,4,1
.#.???.????#????? 1,6
??#?##???#??.????? 9,2
?.?.###??##?#?? 1,11
???.?.???.? 1,1,2
.?#?????#? 3,2
?.??#??#???#?#?## 8,6
???###.?????????? 4,6,1
?.???#???#?## 1,2,2,4
??##??????..???#?? 1,3,3,1,1
.??.#?????#???..?? 1,9,1
...??????? 2,1
???.?###??.????? 3,3,1,1,1
??.?#?..???#????. 2,1,1,3,1
??????..#???.#. 1,4,2,1,1
?.??##?#???##?..???. 11,3
???##?.?##??? 5,4
????.??#?????? 3,7
#??#..?#???#?.? 1,1,2,3,1
????##?#???.?#?# 2,6,4
?#???.##????.? 3,6
.?#????.#????.?.#? 4,1,1,1,2
.??##?#.????#.. 6,3
.#?#??..?? 3,1
#.?.??..??.?? 1,2,1,1
.?????????#???#????? 1,10
?#.#..#?#?#?#????#?? 2,1,3,1,8
??????#????# 6,3
??????..#??#?. 1,1,3
?.??#.??????#?. 1,1,3,1,2
???..##.??##?.????? 1,2,5,2
??????..???# 2,2,1
?????#?.????..?#??#? 4,3,2,3
.??#??????????#??? 11,2,1
??.??..?????.?? 1,1,5,1
#?###?.????????##?? 1,4,9
.?#?#???#??.# 9,1
?????#.??#??#. 1,3,3,1
????#???#??#?.?????. 6,1,2,5
????????.##?# 1,1,2,1
??#?##??????? 8,2
???.???#?#????#??. 1,1,6,2,1
#??.#??????#? 2,1,3,1
.###??.??.? 4,2
?????.??#. 3,1
??????.#..?# 4,1,1,1
?.#??#?.??##?##???? 4,8
??????#?#???? 2,6,1
???..###???..??????? 1,1,4,1,2,1
??..?.???#?? 1,1,1,3
.??#?#????.?.#??#??? 3,1,5
??????.??? 1,1,3
#?.???#??.??#?. 2,5,3
??#??##??.? 6,1
?#?????????#?? 1,10
.????#.??? 4,1
.?###?..?#?#??? 5,5,1
??#??#.?#????.?. 1,1,1,3,1
.???#???#???????? 1,9,1
???..?????? 1,2
??#?.#??##?. 3,2,2
?#?#????.?? 4,2
??#????.##??? 6,4
???#.??.?#?###?.#?? 2,1,6,3
???.?#?##?.? 1,5
?#.?##?.?? 1,4
????###??? 1,4
???##????#?# 1,3,1,3
##???????? 6,2
????#??.####?.? 2,2,1,4,1
#.??#????#???.???? 1,11,1,1
?#??????.? 1,1,1
#..?.?#?.??###??.? 1,1,3,5,1,1
???.??#??#?#?##?? 1,12
??????#??#?##?? 1,2,7
???#???.??.???#? 4,1,5
?????#?????#.?#?#??? 3,1,1,2,5
#??.????#? 3,1,3
???????????...# 8,1
#??#.#.?..????.? 1,1,1,1,4
?#????.??.?. 1,1,2,1
?.??##?.?.???#????.. 5,5
?#??#????.##.## 2,2,2,2,2
?.#????.?? 2,1,1
.#??????????? 1,6
??#.??.#????.??#.??. 2,2,1,1,3,2
??#?#??.??#??? 5,1,2
???#?#??.???.??? 6,2,1
.??#????...?????#.? 6,1,2,1
??.???????.?#??? 2,2,1,4
.?.??????? 1,1,1
.????..??#?#? 2,5
?.?#?##.???.?#??# 1,5,2,1,1
.#??#?.??#?#??.?#??? 2,1,1,5,2,1
?.#??..????#?????#.? 2,10
???#???.?#.???????? 6,1,1,3
?.??#?###??.??##???? 1,8,4,1,1
?????#.??##? 1,2,1,2
..??.##.?.???# 1,2,3
??#?.????#???????? 2,10
?#??????#??.????? 7,1,1,1
#???.?#?.???.??#?? 1,1,2,1,1,5
??##????.#.#?.#?. 6,1,1,1
?#???#??????????.?.? 1,11,1
??#????#???#???. 3,1,8
?#???????.#??? 2,1,2,1
?.#???????.?? 1,1,2
???.????#????#???#? 3,1,4,4,2
????.#??##???#?.### 1,1,6,2,3
??????.?#?#?#?? 2,1,8
.??????.#? 3,1
#??????.????#.????? 1,1,1,2,1,4
???????????????.??# 1,1,7,2
#??.????#?#??.??#?#? 1,7,6
??#?????????## 5,4
????.??#?.. 1,2,4
#?#??.#?#.?? 1,2,3,2
..?#?#?.?#??????#?? 3,1,7
.?????#??###..?#?? 1,6,3
?.#?#????.????###. 1,5,1,1,1,3
?????####?##?.#.??? 10,1,1
.?##???###???. 3,1,6
.??#.?.???.?.?.?? 1,2,1,1
?#????.???.?? 6,1,1
??#.?????#? 1,1,2
.??#?.?.#????? 3,1,1,1
??.?????????# 1,3,1,1
?#.#?????.?????? 2,1,1,5
.????#??..????#? 1,1,3,4
?????..#?.#??# 4,1,4
??.????##?..?#?? 1,2,3,2
???##??.#?##???? 1,2,1,5,2
??#???????#???#? 4,8
#?#??#.???????#?. 4,1,2,1,2
?????#?#??.??.??? 1,5,2,2
?#???#???.? 1,2,1
????.?##??#???#??##? 3,7,5
#?????#?.#? 1,3,2
.??#?####?##?#??? 11,1,1
####??#.###.??.?? 4,2,3,2,1
#???.??#?#??# 1,1,5,1
?##.?????. 3,2
.?.????????#? 1,2,2,3
??????#??.??#?#?.? 8,5
??.?...?..?.??.?.?.? 1,1
.#??.???#.?#?#?? 2,1,1,6
?.#??##??#???????? 1,1,2,4,1,1
##?.?.##??????#??.?? 2,10
.?????##????.?.??#? 1,6,1,1,2
.##??#?#??##?#??? 2,8,2
??.?#.??#?.???#??? 1,2,2,5
?????.?????????#?.? 1,1,3,2,2,1
.#?##???##??.?.# 9,1,1
??????#???????? 7,2
#?????.?????#?. 1,2,1,1,1
?.#?????????#.#?# 1,1,4,1,3
?.??#??#??#??#.. 1,2,2,1,2
??.##??????#?????. 1,2,2,1,1,4
#?.?????#?.?##?? 1,2,2,5
.?#?#?#?.?.# 6,1
#.????#?#??# 1,6,2
??.??????? 1,2
???#?.?..??.??#????. 2,2,4
??????#??????? 2,2,4,1
?.????#?..???? 5,1
???..????.?????? 3,1,3
???.???#??. 1,1
?...?#?.??.?#?.? 2,3
???#..??..#?#??. 4,2,3
..?????#??? 4,1
???##?.#???#?? 6,3,1
????#??.??.. 5,1
??????#??? 3,2
??????????#?????? 3,3
?????.??#??#??? 3,8
?#?##..?#.?#? 1,2,1,2
#???##?#????. 10,1
??????.???#??? 2,2
?????###??.???. 9,1
??##???#????.?#??#? 1,2,5,1,1,2
?.?????#??#.?? 1,5
?#...???#?#??#?. 1,9
???.#?????????.???# 3,6,2,1,1
.?#?#????.?? 7,1
??.#?.#??#??.?? 1,2,1,1,1
????????##?..? 1,1,5,1
?????????????.?.?. 3,5,1
??#?.#?????? 1,1,1,1
?????????#..??#? 3,6,1,1
.?.??..?.??.?.???.?. 1,2
????#???.?###...???? 6,4,1,1
???#?#??#??????..??. 13,2
.##???.?????? 4,2
??????????? 7,1
.???.#?#?##?.???. 1,6,1,1
?????.#?.??#???# 3,2,1,2,1
?????#?#?###??##??# 1,1,1,5,6
???...?#?.#??#?. 2,2,1,2
.?#???????? 2,1
?.?##????????? 1,5,1,1
..??????##?#???.?? 3,8,2
?????.?.??????#?.?? 1,2,3,1,2,2
??#..??##?.# 1,3,1
#?#??..??#.?.?#?.??? 5,3,1,3,1,1
?????#??#??#? 1,2,1,1
??.#???#?#???#?..??? 12,1
??#?#..???#??? 3,1,1,1
?.??.??.#??#???#?#?? 1,11
??#.??#??#??.?? 1,5,2
?#???#?#?#?????.?? 10,1,1,1
?#???#?????##?. 7,4
???##??#?#.???.??. 5,1,1,1,1,2
????.?????#??? 3,1,3,1
.???#?.??#?.????# 3,2,5
??#?????#????#??#??? 4,2,8
?????#???.#?#??? 1,3,1,3,1
?###.???#?????.#? 3,5,1
#.?##..??.#???. 1,2,1,1,1
??#?#??????.#?..?.?? 8,1,2,1,1
????.?????.????#??? 1,1,3,2
?#?#????#????#??# 6,1,1,1,2
.???#?#???#?#?#????? 15,1
..???##.??. 1,3,2
.???#.?#??#???? 4,1,2,1
????????#?#?#??##.? 2,11
??.?.??????#??. 3,3
??.???###????##??? 1,10
#????.?#??.??.??? 5,3,1,1
?.????????##.? 1,5,2,1
???#?##??#??. 2,4,2
?.#??.??#??#?#? 1,1,8
.##???.?#???. 4,1,1
??#.????.?.#??#? 2,2,1,2,2
???##????# 1,5,1
#???????#?..?#??? 4,5,3,1
??.?????.???? 2,1,1,2
??.???.?????.???#?? 1,2,2,1,5
??.??#??#?#?..??. 1,7,1
?#???#?##?..?.?????? 9,5
#?##?#????..#? 6,1,1,1
#????.???. 3,2
?????##.?..??##????? 6,4
??????.??.??? 2,2,1,1
??????#?.??# 1,2,3
????#?????## 1,1,1,2
..#????#??#????. 2,2,2
?#.??.??????? 2,1,1
.#???????#.?#?##.. 1,1,1,1,4
?????#....?.# 3,1,1
???????#??.?#?#?? 1,2,3,4
.???#??#?? 3,1
??#??#???##??.#????? 1,11,1,1,1
??????#.#? 1,4,2
.???#?.#??.? 1,1,2,1
.?#?#????#.# 9,1
?#?.##???.?.?#.#?? 3,4,1,2,1,1
????.???.???..??? 3,2,1,1,1
#?#??..????.?????# 1,2,2,1,1,1
.??#??.#?#??#???? 1,1,1,6,3
?#?????????????#??? 2,1,3,9
?????#.?????? 1,1,1,4
?.??#???#?.#????. 1,3,2,1,1
??..#?#?.? 1,4
????#?????#. 3,1,4
??.?##??#?###??#???? 1,15
????.??#?.?..? 3,3,1
#?.??.??#?####?? 1,1,1,8
?#????##??????????? 14,2
?#????.#??.? 1,2,3
???.##?????#?????? 2,2,1,3,1
.?????????##?.# 1,8,1
??.???????? 1,2,2
??????#?#? 2,1,1
???????.#?? 1,3
?...?####????.?#?? 1,4,2,1,1
.?##?#??????? 9,1
????.???????#???#?? 2,9
?????.?.????? 2,2
????.?????. 1,1
.?????????###.??.? 11,1,1
????##?????.?? 1,2,1,1
???#?.#??##???#?#?.. 4,1,2,5
???????#??.??. 3,1,1,2
.??????????#??#?? 4,6,3
??.?????..?.?##?#??? 1,1,2,1,4,1
??#..??.????? 2,1,1,1
.#??#??.#??#? 1,3,5
.?????##??????.? 3,6,1
##?.?#..?. 3,1,1
?.#.??????#?????#?? 1,12
#??.????.?# 3,1,1
#.#?#.##??#?..???? 1,1,1,6,1,1
????#???.???#??.. 3,4
???????.##??.???? 2,2,4,1
??#??#?.####???#??? 4,10
.????###???###???? 6,6
???.??????. 1,3
??##..?#??#??###? 2,3,1,5
.????#?#????.#? 9,1
??.???#.#????????? 4,1,2,2
???#?.????#?# 1,1,4,1
.#?????.#??? 2,1
??????...???????#??# 5,2,1,5
#.?????###?????. 1,2,6
??##..????..?# 3,2,2
##???????.?#?. 2,2,1,3
??#?.#.??#.? 1,1,1,1
??##.??????..?.??. 4,1,1,1,1,1
??##?#?????????#?#?? 3,8,1,1
???????#????.????#?. 8,1,1,1,2
??????????#????#?? 1,2,11
???#??.??#. 5,2
.??????????# 3,1,2
??#.?????##?#???. 1,10
?.#???#?#???#????# 1,1,4,2,1,1
#????.?#?????#??? 2,2,9
.???#???##? 1,3,3
.??.??#???#? 3,2
???#???##??#???.??## 14,3
???##?##??.##?.?.#?? 2,6,3,1,1
???###????#???? 6,6
??.?.?#?##?##?#???? 1,1,1,5,5
?#???..?.???#?#.?? 5,1,4,1
#?????#????#???#??? 4,1,1,1,5
??#.???#????#???? 1,5,1,2
.??#?#???? 5,1
?.???..#???#?? 1,2,5,1
???#?##????..???##? 7,4
??..#?.???? 2,2,2
?.??#?.##?????#? 4,5,2
?.?##???##??##?#?. 9,4
??#?#??..#??????? 6,4
???#??.??.? 4,1
?..#?#?#?????????#? 1,6,1,2
???.#?..?? 1,2
??????????.?.#?. 4,2,1,1,1
#..??.???###?.?.? 1,1,6,1,1
??.?????#?#??#.?? 1,1,6,2
?.?##???#?? 3,2
??.???????? 1,5,1
?.#???#????#??## 1,1,5,1,2
???????????###??? 2,1,8
???.????.?# 2,1,2
.#?.??#????#.?????? 1,1,1,4,1,1
#???###?##?.??...? 10,2,1
..#.??????.?# 1,1,4,1
????#?????#.? 1,5,1,1
???#??#??#??# 2,1,2,2
?#??????????#? 1,1,3,1
??#??#??#?#?? 3,1,4
???.?????????#. 1,1,1,2,1
#??##??.?#? 5,1,1
..?##???#?#???? 2,6
#??????#?.?? 2,1,2,1
.###???.??###??#?? 5,10
?.????..?????#??? 4,3,2,1
???##??????? 1,3,1,2
????.?.####??####??? 1,11
??##???.?? 4,1
??#?.?????# 1,3,1
??.???...#..?. 1,3,1,1
.##?#??#?#??#??#??? 2,1,5,1,4
?#.????#??????????## 1,1,2,10
.#?.??#???? 2,5
?#?.#?????.??.? 3,4,2,1
.#?????.?..?? 6,1,1
###????????###? 6,3,3
#??????.??#?#? 4,1,6
??????#?????? 1,2,1
.?#.???#??????????#? 2,1,2,1,2,2
.????#?????????? 5,5
.??????????. 5,1
?????????.?#?? 2,5,1
.?#??.?.?? 2,1,2
?.#.?#?#?. 1,4
??##.??##?#??###?? 3,5,3,1
.????..??#?.? 1,1,4
.???#?????# 1,3,3
??????.?????##???.? 6,7
???#?###?.??#?##??# 6,9
##???#?.#?..#?????. 6,2,3,1
???????#?#????#.?.?# 3,11,1,1
?#?.??#??#? 2,3,2
???#?????.?? 7,1,1
?.???????#?#??.?.#? 4,2,3,2
.#.?#.??#??????? 1,1,1,5,1
?.##??????????? 7,1
?.?#????????.? 6,1
.##??#?.???? 2,1,3
#?.#?#?#????.? 1,1,6
?##???#??#.???.? 6,1,1,1
???????#?? 2,1,1
..?#????#???#?? 1,1,3,4
.?.#??##?#.?#??..#? 1,1,5,1,1,1
?#?##?#????. 6,1,1
#?#?????#?##???#?#?# 1,4,12
.????#???? 1,2,1
?..??.???. 1,1
.????????????.???? 4,1,1,1,1,1
??.??##???.?#?? 2,4,1,2
?????#.##???#??#?.? 1,3,4,1,1,1
??#?.?#??##. 1,2,6
.???.??#?#.#????##.? 2,3,1,7
.?.????????. 3,3
?????#.?.#...? 2,2,1,1
??????.##????..?. 3,4
?#.??????#???### 1,1,9
??..???#.??##????#?# 2,1,1,10
?????#?..#?. 3,2,1
???????..?# 2,1,1
???#???#?? 1,3,2
.#?#??.?????????.? 5,1,1,1,1
?.#?.?.??????# 2,6
???#.??????? 1,1,1,3
?#???#?????.#?? 3,5,2
???#???????.?? 1,6,1,1
..?#????#.. 1,4
?????.???# 1,1,3
??#.?????????..? 1,1,1,5,1
??##??...??#??? 6,3
#??#????#? 2,2,1
?#???##.##???? 6,2
?.?#????.?#?.????# 1,3,1,3,1,3
??.##??#?????????.. 1,8,1,1
?###?##.?????#?.???# 4,2,1,4,3
???.???????.#.??? 2,1,3,1,2
??.???#????. 1,4,1
.?##?????##???.???? 13,2
??##.???????#??#??#? 2,1,2,5,2
#??????##???. 2,1,3,2
#.???????? 1,1,1
?#?.#.?#??.??????? 1,1,4,1,3
?????#??#??? 2,5
??.??#?#?? 2,5
?.#?#?#?????????. 1,9,2,1
??#??.?##.??#.??? 1,3,1,1,3
???????.?????? 4,6
#?.?#??#?????.??? 2,9,1
#??#??#?.??#????# 5,2,4,1
?#.#?#?.?? 1,4
.?.?.????#??#?? 1,1,1,2,2
?.#???????#?.?. 1,1,3,1
#.??????..?.?. 1,4,1,1
???????.#???#??.? 7,6,1
?..##???##???? 3,3
?????###?#..???#.?#? 1,1,5,1,1,1
??.????#?.?..# 2,2,1,1
????#???##??#? 6,5
#?????##??????? 1,1,3,1,4
#?.?????#?.?? 1,2,1,1
??..#?#??##? 1,3,3
???#??#???#??. 4,1,1
???.#??##???????? 3,6,1,1,1
#?###?#?##?.#?.?.?.. 1,9,1,1,1
?#???#??#?.?.#???? 1,4,1,4
????..#.?.???#??.? 2,1,1,4,1
?????##??#.??#?.# 9,2,1
????.?##??#?????..?. 2,3,1
??????.#?#???#??.??# 4,8,3
?#?##?#????????#?? 7,1,3
?#??###??#?#?#?.? 13,1
?.??##???.??????#.? 1,6,1,2,1,1
??#??#????? 3,3,1
??.??????????#.. 5,5
????????#?? 2,6
#?.??#???.#??? 1,6,1,1
##.?????#?. 2,2,1
????#??.?#???? 4,1,5
.?????????????##?.? 5,3
.?.???.?#??.## 2,1,2
.?????????###????? 3,5
.###??.##?? 5,3
?#??????#?.??#???? 5,3,3
.????#??????? 1,2
??#??????..#???#?. 3,1,5
.???#?#?.???.?????? 6,3,2,2
??.#??.???. 3,2
?.??.???#.?? 1,4,1
.?????.???..#?? 1,1,1,1,3
#????????? 4,2
????#?...????????#?# 1,2,1,9
??#?#####???? 2,5,1
.??#???#?. 3,2
?#?#?.##????#?????? 1,1,9,2
?####?????.?.???? 8,2
#???#??.??.??? 2,3,1,3
.#??##?????#.#?? 7,1,1,1,1
?..????.???###????. 1,7
???##???#???.??#?#? 9,1,6
???#?????????. 3,5
#?#??#??#?. 3,5
?#??.?.???? 3,1
???###.?#.. 3,2
?????????.??? 4,1,1,2
???#??#??.? 8,1
#..??.#???? 1,5
????#??###?#?#?#???? 2,1,6,7
???????????###????. 13,1
???####?.? 1,4,1
?##.???#????##?##?? 2,1,9
???..??..?.#?#??#.. 3,2,6
.#?#???.?#?##??? 1,1,1,6,1
??#?..??????#??? 1,6,1
#.????#??????# 1,8
???#??..?? 1,1
???..????????? 1,1,4,1
.????.#???. 1,1
#???#?#?#?.??.#?? 9,2
#??#?##????.??.?? 10,1
.?#?.?????##????#? 2,11
????#??.#???#?????? 1,4,1,3,1,1
.?.??..???#?? 1,2,5
.#?????.?.???#?#??#? 1,4,2,1,1,1
??#????#??#???#.??? 1,1,10,1,1
.???..#??#???.. 2,7
??.#???.#?????? 1,2,1,5
????#??.??????#? 1,3,1,3,2
##?????##..???.???.? 2,6,3,1,1
??##???.??????#?? 7,4,1
#..##.??#???#??? 1,2,1,1,3
#??.?##...?? 1,3
??##?...###... 5,3
#?#??#????#??#..#? 11,2,1
???#?????#?#???#??.? 4,8
??.??????#????????? 9,1
??.??.?????# 1,1,5
???.??????#??? 1,1,3,1
.?.#???.???#?????? 2,7
???##??.?#?###? 2,2,1,2,3
???????#.??.#????#.? 1,4,1,1,2,1
.???#.????#.?????? 1,1,5,2,1
?.?.???###?##???? 1,10
?????.?#?.? 5,1
????????##.?? 3,5,1
.???#??##?####??? 1,6,4
#?????????#?. 3,4
.?.??#?.??.???.? 1,1
.???#?????? 4,1,1
???#?#?..?...#???.. 4,1,1,1
?????.????##???? 1,1,1,1,6
??#..????? 1,1
?#?.?????#??#..?#. 2,2,2,2,2
????#..????? 4,3
??????????#.?. 2,4,1
??..#?????..?.#???? 1,6,1,1,1
??#?####????? 10,1
?#???#.?..?? 3,1,1
?????#????????????? 5,4,2
##??.??..?.?? 2,1
.?#?#??.??####???? 6,8
##?.??#???#?#???. 3,4,3
?#.?#...?#.???.# 1,1,2,2,1
?#..????#??? 2,2,3,1
??#??????? 2,1
????..?.????#?# 3,1,1,3
?????.??.????#???#?? 1,1,1,1,2,7
.?##??.?#?.? 4,2
????#??.??. 5,1,1
??????.??? 5,2
????????#?#? 2,1,4
??.?????????#??.#?? 2,5,4,1
??.??????????? 1,4,1,1
???#????.? 2,4,1
??????.?#?# 1,2,3
#???????#?. 1,4,1
????#.??#???.???.? 5,1,1,1,2,1
?#?????.??##?? 1,1,2,3
?...???????? 1,1,3
.##????#.?#?? 3,2,1
#??#?.?.#??##.????? 5,1,5,1,1
.???#????? 6,1
?#???????.?###??#. 2,1,1,4,1
#??????.???????? 5,1,1,1,3
.?#??###?#?#?##?..?? 15,2
.?.??#?######?.??.?? 1,10,2
??#???.#??#?????# 5,8,1
????.????? 4,3
??#.???.??? 1,1,3
.????.##??????#?##? 4,2,2,4
??#??????###????#?.? 4,1,10,1
????#..???? 4,2
#?????????#???????.# 1,2,1,1,3,1
?#??##???.#?#.? 8,3,1
????.#?#???#### 1,1,1,3,4
??.?#?#?#?.??. 1,1,4,1
??#??????????.# 2,4,1
???#??.???##??#? 6,1,2,3
?.???#?#??#??##?.?.. 14,1
??.#??#?#??? 4,3
?#?.??????#??????#? 2,15
???.???#??.???#??. 1,2,3,5
?#?.?#?#?#?#???#???? 2,4,1,1,5,1
???????????#???. 1,1,6
??????????.?? 2,5,1
.##???????.?#???? 9,3
.???..?.?###? 2,1,3
?#??##??????????. 10,1
?????.????.?##?? 4,1,4
.???##?.???????#? 1,2,1,6
????????????.?? 5,1,2
.?#????????? 3,1,3
#?.?#?.??. 2,1
?#?#????????. 7,1
??????####???????#? 2,10,1
?.???..????? 1,4
.????##??#?##? 2,9
#??#?#?#??.#.#?? 9,1,2
?#??.?###???????? 1,1,6,2,1
?###??????.?# 4,2,1
#.??#??.?##?#. 1,4,5
?????.????????? 1,1,5,2
??.?#..#?????#?? 1,2,3,5
?.??#????.?????#?# 6,8
?.??#.?##?????? 1,2,6,1
#??#.?.?.#?#?????#?# 1,1,1,1,1,9
.????#??##?????#??? 9,5
?#????#?##.????? 7,2,1,1
?.??????.??? 1,1,2,1
??##???#?##?? 4,5,1
#??????####?.???? 1,8,1,1
?.#?###?????#?#? 5,4
?.??#.???.#.#?#. 1,2,1,1,3
#.#?#?##??##?.??.. 1,10,2
???????#?????#??? 3,2,1,1,5
.?.#??.?#?#?.?#???? 1,1,4,2,2
??##???.???# 6,1,1
?#??..???#?#???#.??? 1,1,2,5,1,1
##?.??#???#??###? 2,3,2,5
?.???#???#?#?#???#? 1,1,1,1,9
?#??#??#??.?.#?. 2,2,2,1,2
????#??.?##? 4,3
?.?#???..?####???? 1,2,1,7,1
#???????.? 1,2,1
#?..???..??????? 1,1,1,1
.#??#?????? 1,6,1
.#?.?.???##?? 1,1,5
??#????.###?##??? 2,2,3,2,2
?#?.?.???. 2,1
.??..???????.????? 2,3,1,1,1,1
.??.#???.???? 3,2
...?.??#???.. 1,1
.??.?.?????????#??? 1,3,2,5
?.???..?#.#????# 1,2,1,6
.?#???.??#?????. 4,5
?##?.???..#? 3,3,2
.##???#?#?.?#??.??? 3,4,3,2
.????#??.?? 4,1
?##??#?###???#???#?? 2,5,1,5,1
??#??.?.##??? 1,2
..#????#??#?? 1,2,1,3
??????##?. 2,3
.????????.?#????? 1,6,1,2
??.?#????.#??#?. 1,2,2,1,1
.?#?????????.#?# 2,5,1,1,1
???????.???????#?#? 2,10
?#?#?.#.?????#? 3,1,2,2
???????#?????????? 3,1,4,2
?.?.??????? 1,3,1
????.#???#?.##.?? 1,1,5,2
????..#????.????? 3,1,1,1,2
????#?.#???#?? 6,6
?.?#???.??.??### 1,2,1,1,3
..##?.??#?.?#?.#?. 3,1,2,2,2
.?##?#??.? 2,1,1
?#???##?????. 6,1
???#?#???#?#?#???? 2,3,7,2
.#?#?..####?? 1,1,6
#???#??#????? 2,9
?..?#??????#???.?#? 1,1,8,2
?.#???#??? 1,1,4
..???##???#?#?.#??. 11,2
????##????. 1,6
??????#??.?????. 1,1,1,2,2
?#?##???????#.?#? 13,2
?????????# 2,2
##???????. 5,3
????????##??# 2,5,1
???#?#?##???#?#??#? 8,1,1,4
?.????????. 6,1
???????#.??#?#??# 4,3,7
#####????#?????????. 10,1,1,1
#??????#?#.?????? 1,6,1,2
.??.??????????#?# 4,3
.???..#??. 1,3
???.?????? 1,1,2
#?.??#???.??? 1,3,1,1
???????.???.. 1,2
.##???#?.#???#?#?# 2,2,9
.?#???.?.? 1,1
?#?#????#?#.??#? 4,3,1,4
.?????.?????????# 4,1,6,1
????.???#?#??###? 4,1,5,3
??#????????#??#?..# 3,1,1,3,1,1
.?????.?????????.# 1,1,1,1,5,1
..?????????#???.??? 5,5,1
??#????#?? 1,1,1
????#?#?????? 1,1,4,1
???#??#??.?#?? 7,2
????.#??.?.##? 1,1,1,3
??.#???.??? 1,2,1
#?????##?#????? 11,1
?...??#??. 1,5
?????#?#?.???# 1,1,3,4
??.??##.####????.# 2,1,2,7,1
??#????..? 5,1
????#??#???#??#?##? 3,2,7
.???##????.##?##?. 5,5
??#??#??#?#? 1,9
??#?#??#??.#???#???? 10,5,2
.??.?????#? 2,1,2
???#.??#?#??#? 1,1,9
??#?????..???# 7,4
..#??.?###???#?#.? 3,9
???#?????##?.????# 3,4,5
#??#?#???# 1,4,2
??#??#???#?.#?#??? 1,1,6,1,1,1
??#????.???#.#? 2,2,1,1,2
##?#?????#?.????#?? 6,3,5
????#?.?????? 3,3
??#.???.?.#????#???? 2,1,2,7
??#?#???.???? 8,1
#.?#.?#????.???. 1,1,3,1,3
##???#????.?..?.??? 10,1,1,1,1
????#??#?????? 1,7,3
???.?.??.??? 2,1,1,1
?#?###?????.?#?#?.?? 9,1,1,1,1
???###?##???.#? 1,4,2,1,1
????###?????#?.? 1,11,1
????#??..??##??? 5,1,3
.????##??????..##. 12,2
?.#????#?? 2,2
????????#?#????#??.? 2,4,3
????.#???.??#?#. 4,3,5
??##????.#?.?#. 7,1,1
.?.??.??..? 1,2
##???.#?.? 2,2,2
.?????#?.??#.? 4,2,1
..##??#??#? 2,2,2
??..?.?.??..?. 1,1
???.?.?..???#?#?? 1,1,8
???##?#???#????? 1,3,2,2,1
?.?????#?????#??.??? 1,1,2,6,2
?????.#?????#?#???. 1,1,9,2
?#?.????.???????## 1,4,1,1,1,2
.?.?##??.### 2,3
??????##???# 2,4,2
.?#.#.?#????..#.?? 2,1,1,3,1,1
?.#???..??????.? 2,3
#..#??????????? 1,1,3,5
??.??.???.?...? 1,2
.?.#???#?#. 1,4
#??..??#.?#? 1,1,1,3
?.?##??.#.?? 4,1
???????.#??? 1,2,1,1
.????#??.?. 2,3,1
????.?#???? 2,3,1
???#???.?#?????? 1,4,2,2,1
.#?????..???????.? 6,7
#+end_example


* Part 1
#+begin_src elisp :var input=input
(defun aoc23/convert-input (line)
  (let* ((segs (string-split line " " t))
	 (springs (car segs))
	 (checks (cadr segs)))
    (list (cons 'low (aoc23/springs-to-number springs 'low))
	  (cons 'high (aoc23/springs-to-number springs 'high))
          (cons 'candidates (aoc23/springs-to-candidates springs))
	  (cons 'pattern (aoc23/checks-to-pattern checks)))))

(defun aoc23/springs-to-candidates (springs)
  (let ((i nil)
      (m nil)
      (c nil)
      (b 0)
      (base 0))
  
  (while (setq i (string-match (rx "?") (reverse springs) (if i (1+ i) 0)))
    (setq m (cons (lsh 1 i) m)))
  (setq i nil)
  (while (setq i (string-match (rx "#") (reverse springs) (if i (1+ i) 0)))
    (setq base (logior base (lsh 1 i))))
  (cons base (build-patterns m base))))

(defun build-patterns (candidates base)
  (let ((m candidates)
        (out '()))
    (while m
      (let ((n (logior base (car m))))
        (setq m (cdr m))
        (setq out (cons n out))
        (when m
          (setq out (append out (build-patterns m n))))
      ))
    out))

(defun aoc23/springs-to-number (in low)
  (let* ((in (string-replace "?" (if (eq low 'low) "#" ".") in))
	 (in (string-replace "." "0" in))
	 (in (string-replace "#" "1" in)))
    (string-to-number in 2)))

(defun aoc23/checks-to-pattern (check)
  (let ((c (mapcar 'string-to-number (split-string check "," t)))
	(matches '()))
    (apply 'concat `("^0*" 
		     ,(string-join 
		       (mapcar (lambda (n)
				 (format "1\\{%d\\}" n))
			       c)
		       "0+")
		     "0*$"))))

(defun int-to-binary-string (i)
  "convert an integer into it's binary representation in string format"
  (let ((res ""))
    (while (not (= i 0))
      (setq res (concat (if (= 1 (logand i 1)) "1" "0") res))
      (setq i (lsh i -1)))
    (if (string= res "")
	(setq res "0"))
    res))

(defun aoc23/spring-config-p (number check)
  (let ((s (int-to-binary-string number))
        (p (alist-get 'pattern check)))
    (string-match-p p s)))
		    

(defun aoc23/part-1 (input)
  (let ((in (string-split input "\n" t))
	(sum 0))
    (dolist (line in)
      (let* ((m (aoc23/convert-input line))
	     (i (alist-get 'low m))
	     (last (alist-get 'high m))
             (c (alist-get 'candidates m)))
	(dolist (s c)
	  (when (aoc23/spring-config-p s m)
	    (setq sum (1+ sum)))
	  (setq i (1+ i)))))
    sum))


(aoc23/part-1 input)
#+end_src

#+RESULTS:
: 7541

* Part 2
#+begin_src elisp :var input=example
(defun aoc23/convert-input (line)
  (let* ((segs (string-split line " " t))
         (segs (mapcar (lambda (s)
                         (apply 'concat (make-list 5 s)))
                       segs))

	 (springs (car segs))
	 (checks (cadr segs)))
    (list (cons 'low (aoc23/springs-to-number springs 'low))
	  (cons 'high (aoc23/springs-to-number springs 'high))
          (cons 'candidates (aoc23/springs-to-candidates springs))
	  (cons 'pattern (aoc23/checks-to-pattern checks)))))

(defun aoc23/springs-to-candidates (springs)
  (let ((i nil)
      (m nil)
      (c nil)
      (b 0)
      (base 0))
  
  (while (setq i (string-match (rx "?") (reverse springs) (if i (1+ i) 0)))
    (setq m (cons (lsh 1 i) m)))
  (setq i nil)
  (while (setq i (string-match (rx "#") (reverse springs) (if i (1+ i) 0)))
    (setq base (logior base (lsh 1 i))))
  (cons base (build-patterns m base))))

(defun build-patterns (candidates base)
  (let ((m candidates)
        (out '()))
    (while m
      (let ((n (logior base (car m))))
        (setq m (cdr m))
        (setq out (cons n out))
        (when m
          (setq out (append out (build-patterns m n))))
      ))
    out))

(defun aoc23/springs-to-number (in low)
  (let* ((in (string-replace "?" (if (eq low 'low) "#" ".") in))
	 (in (string-replace "." "0" in))
	 (in (string-replace "#" "1" in)))
    (string-to-number in 2)))

(defun aoc23/checks-to-pattern (check)
  (let ((c (mapcar 'string-to-number (split-string check "," t)))
	(matches '()))
    (apply 'concat `("^0*" 
		     ,(string-join 
		       (mapcar (lambda (n)
				 (format "1\\{%d\\}" n))
			       c)
		       "0+")
		     "0*$"))))

(defun int-to-binary-string (i)
  "convert an integer into it's binary representation in string format"
  (let ((res ""))
    (while (not (= i 0))
      (setq res (concat (if (= 1 (logand i 1)) "1" "0") res))
      (setq i (lsh i -1)))
    (if (string= res "")
	(setq res "0"))
    res))

(defun aoc23/spring-config-p (number check)
  (let ((s (int-to-binary-string number))
        (p (alist-get 'pattern check)))
    (string-match-p p s)))
		    

(defun aoc23/part-1 (input)
  (let ((in (string-split input "\n" t))
	(sum 0))
    (dolist (line in)
      (let* ((m (aoc23/convert-input line))
	     (i (alist-get 'low m))
	     (last (alist-get 'high m))
             (c (alist-get 'candidates m)))
	(dolist (s c)
	  (when (aoc23/spring-config-p s m)
	    (setq sum (1+ sum)))
	  (setq i (1+ i)))))
    sum))


(aoc23/part-1 input)
#+end_src
